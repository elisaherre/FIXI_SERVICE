<div class = "container mt-5 mb-3">
  <div class="d-flex justify-content-center mb-3">
  <h1>MIS SOLICITUDES</h1>
  </div>

  <!-- Solicitudes enviadas -->
  <div class="d-flex flex-row mb-3 justify-content-center">
    <div class="col-6">
      <% if @sent_requests.size > 0 %>
      <% @sent_requests.each do |request| %>
      <div class="card">
        <div class="card-header">
          Solicitud de servicio de <%= request.service.category.name.capitalize %>
        </div>
        <div class="card-body">
          <p class="card-text">Fixer: <%= request.service.user.name %></p>
          <p class="card-text">Status: <%= request.status.capitalize %></p>
          <p class="card-text">Descripción:</p>
          <p class="card-text"><%= request.description %></p>
          <div class="d-flex justify-content-start mt-3">
            <!-- Botones de reseña (se muestra al finalizarse la request) -->
            <%= link_to "Crear una reseña", new_request_review_path(request), class: "btn btn-fixi" if request.status == "finalizada" && Review.where(user: current_user, request: request).size == 0 %>
            <!-- Botones de status -->
            <% if request.status == "enviada" %>
            <%= button_to "Cancelar solicitud", cancel_path(request), method: :patch, class: "btn btn-fixi" %>
            <% elsif request.status == "aceptada" %>
            <%= button_to "Reservar visita", book_path(request), method: :patch, class: "btn btn-fixi" %>
            <% elsif request.status == "por pagar" %>
            <%= button_to "Pagar", pay_path(request), method: :patch, class: "btn btn-fixi" %>
            <%= button_to "Cancelar", cancel_path(request), method: :patch, class: "btn btn-fixi" %>
            <% end %>
          </div>
        </div>
      <% end %>
      <% end %>
      </div>
    </div>
  </div>


  <!-- Solicitudes recibidas -->
  <div class="d-flex flex-row mb-3 justify-content-center">
    <div class="col-6">
      <% if @received_requests.size > 0 %>
        <% @received_requests.each do |request| %>
          <div class="card">
            <div class="card-header">
              Solicitud de servicio de <%= request.service.category.name.capitalize %>
            </div>
            <div class="card-body">
              <p class="card-tex">Cliente: <%= request.user.name %></p>
              <p class="card-text">Status: <%= request.status.capitalize %></p>
              <p class="card-text">Descripción:</p>
              <p class="card-text"><%= request.description %></p>
              <div class="d-flex justify-content-start mt-3">
                <!-- Botones de reseña (se muestra al finalizarse la request) -->
                <%= link_to "Crear una reseña", new_request_review_path(request, cliente: request.user.id), class: "btn btn-fixi" if request.status == "finalizada" && Review.where(user: current_user, request: request).size == 0 %>
                <!-- Botones de status -->
                <% if request.status == "enviada" %>
                <%= button_to "Aceptar solicitud", accept_path(request), method: :patch, class: "btn btn-fixi" %>
                <%= button_to "Declinar solicitud", cancel_path(request), method: :patch, class: "btn btn-fixi" %>
                <% elsif request.status == "reservada" %>
                <%= button_to "Presupuestar servicio", budget_path(request), method: :patch, class: "btn btn-fixi" %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
